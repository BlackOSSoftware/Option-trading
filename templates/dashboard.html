<!DOCTYPE html>
<html lang="en">
<head>
    <title>Options Strategy Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <meta http-equiv="refresh" content="7">
    <meta charset="UTF-8">
</head>

<body>

<!-- ================= TOP BAR ================= -->
<header class="top-bar">
    <h1>OPTIONS STRATEGY DASHBOARD</h1>
    <div class="top-status">
        <span class="time">{{ time }}</span>
        <span class="live-badge">LIVE</span>
    </div>
</header>

<!-- ================= ROW 1 ================= -->
<section class="grid-3">

    <!-- Strategy Context -->
    <div class="card">
        <h2>STRATEGY CONTEXT</h2>
        <div class="metric">
            <span>Instrument</span>
            <b>NIFTY</b>
        </div>
        <div class="metric">
            <span>Target Delta</span>
            <b>{{ trade.targetDelta }}</b>
        </div>
        <div class="metric">
            <span>Expiry Date</span>
            <b>{{ trade.finalPair.call.expiry }}</b>
        </div>
    </div>

    <!-- Market Snapshot -->
    <div class="card">
        <h2>MARKET SNAPSHOT</h2>
        <div class="metric"><span>Spot</span><b>{{ trade.spot }}</b></div>
        <div class="metric"><span>ATM</span><b>{{ trade.atm }}</b></div>
        <div class="metric"><span>Strategy</span><b>Delta Neutral</b></div>
        <div class="metric"><span>Structure</span><b>Short Strangle</b></div>
    </div>

    <!-- Strategy Summary -->
    <div class="card">
        <h2>STRATEGY SUMMARY</h2>

        <div class="metric">
            <span>Net Credit</span>
            <b>
                ₹ {{ trade.finalPair.callPremium + trade.finalPair.putPremium }}
            </b>
        </div>

        <div class="metric">
            <span>Hedge Cost</span>
            <b>₹ {{ trade.hedgeOptions.hedgeCost }}</b>
        </div>

        <div class="metric risk">
            <span>Risk Profile</span>
            <b>
                {% if trade.strategyStatus.exit_strategy %}
                    HIGH RISK
                {% elif trade.strategyStatus.hedge_needed %}
                    MEDIUM RISK
                {% else %}
                    CONTROLLED
                {% endif %}
            </b>
        </div>

        <small class="muted">
            Risk derived from live premium movement & strategy thresholds
        </small>
    </div>

</section>

<!-- ================= ROW 2 ================= -->
<section class="grid-2">

    <!-- Call -->
    <div class="card call">
        <h2>CALL (SHORT)</h2>
        <div class="kv"><span>Strike</span><b>{{ call.strikePrice }}</b></div>
        <div class="kv"><span>Premium</span><b>{{ call.ltp }}</b></div>
        <div class="kv"><span>Delta</span><b>{{ call.delta }}</b></div>
        <div class="kv"><span>VWAP</span><b>{{ call.vwap }}</b></div>
    </div>

    <!-- Put -->
    <div class="card put">
        <h2>PUT (SHORT)</h2>
        <div class="kv"><span>Strike</span><b>{{ put.strikePrice }}</b></div>
        <div class="kv"><span>Premium</span><b>{{ put.ltp }}</b></div>
        <div class="kv"><span>Delta</span><b>{{ put.delta }}</b></div>
        <div class="kv"><span>VWAP</span><b>{{ put.vwap }}</b></div>
    </div>

</section>

<!-- ================= STRATEGY BREAKDOWN ================= -->
<section class="card full">
    <h3>STRATEGY DATA BREAKDOWN</h3>

    <div class="row three">

        <div>
            <h4>CALL DETAILS</h4>
            <p>Strike: <b>{{ call.strikePrice }}</b></p>
            <p>LTP: ₹ {{ call.ltp }}</p>
            <p>VWAP: {{ call.vwap }}</p>
            <p>Delta: {{ call.delta }}</p>
            <p>Sold At: {{ call.soldAt }}</p>
        </div>

        <div>
            <h4>PUT DETAILS</h4>
            <p>Strike: <b>{{ put.strikePrice }}</b></p>
            <p>LTP: ₹ {{ put.ltp }}</p>
            <p>VWAP: {{ put.vwap }}</p>
            <p>Delta: {{ put.delta }}</p>
            <p>Sold At: {{ put.soldAt }}</p>
        </div>

        <div>
            <h4>STRATEGY STATUS DETAILS</h4>
            <p>Total Credit: ₹ {{ trade.strategyStatus.total_sold }}</p>
            <p>Live Loss: ₹ {{ trade.strategyStatus.live_loss }}</p>
            <p>Hedge Needed: {{ trade.strategyStatus.hedge_needed }}</p>
            <p>Exit Triggered: {{ trade.strategyStatus.exit_strategy }}</p>
            <p>Total Strategy Loss: ₹ {{ trade.strategyStatus.total_strategy_loss }}</p>
        </div>

    </div>
</section>

<!-- ================= ROW 3 ================= -->
<section class="grid-1">
    <div class="card">
        <h2>STRATEGY STATUS</h2>
        <div class="status-grid">
            <div>Total Sold <b>₹ {{ trade.strategyStatus.total_sold }}</b></div>
            <div>Premium Diff <b>{{ trade.finalPair.premiumDiff }}</b></div>
            <div>Hedge Needed <b>{{ trade.strategyStatus.hedge_needed }}</b></div>
            <div>Exit Strategy <b>{{ trade.strategyStatus.exit_strategy }}</b></div>
        </div>
    </div>
</section>

<!-- ================= ROW 4 ================= -->
<section class="grid-2">

    <!-- Call Hedges -->
    <div class="card">
        <h2>CALL HEDGES</h2>
        <table>
            <tr><th>Strike</th><th>Premium</th><th>Delta</th></tr>
            {% for h in trade.hedgeOptions.call_5rs %}
            <tr>
                <td>{{ h.strikePrice }}</td>
                <td>{{ h.ltp }}</td>
                <td>{{ h.delta }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Put Hedges -->
    <div class="card">
        <h2>PUT HEDGES</h2>
        <table>
            <tr><th>Strike</th><th>Premium</th><th>Delta</th></tr>
            {% for h in trade.hedgeOptions.put_5rs %}
            <tr>
                <td>{{ h.strikePrice }}</td>
                <td>{{ h.ltp }}</td>
                <td>{{ h.delta }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

</section>

<footer>
    Strategy auto-starts daily at <b>09:15 AM IST</b> · Client Demo Mode
</footer>

</body>
</html>
